<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix JavaScript Loading Issue</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .fix-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        h1 {
            color: #28a745;
            border-bottom: 3px solid #28a745;
            padding-bottom: 10px;
        }
        
        h2 {
            color: #035847;
            margin-top: 25px;
        }
        
        .step {
            background: #f8f9fa;
            padding: 20px;
            border-left: 4px solid #28a745;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .urgent {
            background: #fff3cd;
            border-left-color: #ffc107;
        }
        
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .highlight {
            background: #d4edda;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .console-steps {
            background: #e9ecef;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        ol {
            margin: 10px 0;
            padding-left: 25px;
        }
        
        li {
            margin: 8px 0;
        }
        
        .error-fix {
            background: #f8d7da;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="fix-card">
        <h1>‚úÖ API Works! Now Let's Fix Your Website</h1>
        <p>Since the API link works, the issue is in your website's JavaScript. Let's debug and fix it.</p>
    </div>

    <div class="fix-card">
        <h2>üîç Step 1: Check Browser Console for Errors</h2>
        
        <div class="console-steps">
            <h3>Follow these steps exactly:</h3>
            <ol>
                <li>Go to your directory page (where it's stuck loading)</li>
                <li>Press <strong>F12</strong> (or right-click ‚Üí "Inspect Element")</li>
                <li>Click the <strong>"Console"</strong> tab</li>
                <li>Look for <span style="color: red;">red error messages</span></li>
                <li>Tell me what errors you see (if any)</li>
            </ol>
        </div>
        
        <div class="step">
            <h3>Common errors you might see:</h3>
            <ul>
                <li><strong style="color: red;">CORS error:</strong> "Access to fetch... has been blocked"</li>
                <li><strong style="color: red;">Reference error:</strong> "GOOGLE_SHEETS_ID is not defined"</li>
                <li><strong style="color: red;">Syntax error:</strong> "Unexpected token" or "Missing }"</li>
                <li><strong style="color: red;">Network error:</strong> "Failed to fetch"</li>
            </ul>
        </div>
    </div>

    <div class="fix-card">
        <h2>üîß Step 2: Add Debug Code (Temporary Fix)</h2>
        
        <div class="step urgent">
            <h3>Replace your current loadBusinesses function with this debug version:</h3>
            <p>This will show us exactly what's happening and where it's failing.</p>
            
            <div class="code-block">
// Debug version of loadBusinesses function
async function loadBusinesses() {
    console.log('üöÄ loadBusinesses started');
    console.log('üìä Sheet ID:', GOOGLE_SHEETS_ID);
    console.log('üîë API Key:', API_KEY);
    
    const grid = document.getElementById('businessGrid');
    const countElement = document.getElementById('businessCount');
    
    // Update loading message
    grid.innerHTML = '<div class="loading">üîÑ Connecting to Google Sheets...</div>';
    countElement.textContent = 'Connecting to API...';
    
    try {
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEETS_ID}/values/${SHEET_NAME}?key=${API_KEY}`;
        console.log('üåê Fetching URL:', url);
        
        // Update status
        grid.innerHTML = '<div class="loading">üì° Making API request...</div>';
        
        const response = await fetch(url);
        console.log('üì® Response status:', response.status);
        console.log('üì® Response OK:', response.ok);
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        // Update status
        grid.innerHTML = '<div class="loading">üìÑ Processing data...</div>';
        
        const data = await response.json();
        console.log('üìÑ Received data:', data);
        
        if (data.error) {
            console.error('‚ùå API returned error:', data.error);
            throw new Error(data.error.message);
        }

        if (!data.values) {
            console.log('‚ö†Ô∏è No values in response');
            throw new Error('No data found in spreadsheet');
        }
        
        if (data.values.length <= 1) {
            console.log('‚ö†Ô∏è Only headers found, no business data');
            displayNoResults('No businesses found in the directory.');
            return;
        }

        console.log('‚úÖ Found', data.values.length - 1, 'businesses');
        
        // Update status
        grid.innerHTML = '<div class="loading">üèóÔ∏è Building business cards...</div>';
        
        // Process the data
        const headers = data.values[0];
        const rows = data.values.slice(1);
        
        console.log('üìã Headers:', headers);
        console.log('üìä Sample business:', rows[0]);

        allBusinesses = rows.map((row, index) => {
            const business = {
                timestamp: row[0] || '',
                email: row[1] || '',
                businessName: row[2] || '',
                ownerName: row[3] || '',
                phone: row[4] || '',
                ownerEmail: row[5] || '',
                address: row[6] || '',
                interestedInEvents: row[7] || '',
                facebook: row[8] || '',
                instagram: row[9] || '',
                description: row[10] || '',
                hours: row[11] || '',
                businessDescription: row[12] || '',
            };
            
            if (index < 3) {
                console.log(`üìä Business ${index + 1}:`, business);
            }
            
            return business;
        }).filter(business => business.businessName && business.businessName.trim() !== '');

        console.log('üè¢ Processed businesses:', allBusinesses.length);
        
        if (allBusinesses.length === 0) {
            console.log('‚ö†Ô∏è No valid businesses after filtering');
            displayNoResults('No valid businesses found.');
            return;
        }

        filteredBusinesses = [...allBusinesses];
        
        // Update status
        grid.innerHTML = '<div class="loading">üé® Rendering business cards...</div>';
        
        console.log('üé® About to display businesses');
        displayBusinesses();
        updateBusinessCount();
        
        console.log('‚úÖ loadBusinesses completed successfully');

    } catch (error) {
        console.error('üí• Error in loadBusinesses:', error);
        console.error('üí• Error stack:', error.stack);
        
        displayError(`Failed to load businesses: ${error.message}`);
        countElement.textContent = 'Error loading businesses';
    }
}
            </div>
        </div>
    </div>

    <div class="fix-card">
        <h2>üõ†Ô∏è Step 3: Check Your Configuration</h2>
        
        <div class="step">
            <h3>Make sure these values are EXACTLY correct in your code:</h3>
            
            <div class="code-block">
// Configuration - CHECK THESE VALUES
const GOOGLE_SHEETS_ID = '13zFJOIrKOGaJSuIZEQRjAS5trCD-qDBrvLO5dJcXO2I';
const API_KEY = 'AIzaSyA_D9VSFEaQn4XnMsjNLHg7qS999n4gl1M';
const SHEET_NAME = 'Form Responses 1';
            </div>
            
            <div class="highlight">
                <h4>‚ö†Ô∏è Common mistakes to check:</h4>
                <ul>
                    <li>Extra spaces before or after the values</li>
                    <li>Missing quotes around the strings</li>
                    <li>Typos in the variable names</li>
                    <li>Missing semicolons</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="fix-card">
        <h2>üéØ Step 4: Test the Debug Version</h2>
        
        <div class="step">
            <h3>After adding the debug code:</h3>
            <ol>
                <li>Save and upload your directory.html file</li>
                <li>Refresh the directory page</li>
                <li>Open browser console (F12 ‚Üí Console)</li>
                <li>Watch the console messages</li>
                <li>Tell me exactly what you see in the console</li>
            </ol>
        </div>
        
        <div class="step">
            <h3>The debug version will show:</h3>
            <ul>
                <li>üöÄ <strong>Starting messages:</strong> "loadBusinesses started"</li>
                <li>üåê <strong>The API URL being called</strong></li>
                <li>üì® <strong>Response status:</strong> Should be 200</li>
                <li>üìÑ <strong>Raw data received:</strong> Your spreadsheet data</li>
                <li>üè¢ <strong>Number of businesses processed</strong></li>
                <li>‚úÖ <strong>Success message:</strong> "loadBusinesses completed successfully"</li>
            </ul>
        </div>
    </div>

    <div class="fix-card">
        <h2>üöÄ Quick Fixes for Common Issues</h2>
        
        <div class="error-fix">
            <h3>If you see "GOOGLE_SHEETS_ID is not defined":</h3>
            <p>Your configuration variables aren't properly declared. Make sure they're at the very top of your script section.</p>
        </div>
        
        <div class="error-fix">
            <h3>If you see "displayBusinesses is not a function":</h3>
            <p>The function is missing or has a syntax error. Make sure all functions are properly defined.</p>
        </div>
        
        <div class="error-fix">
            <h3>If you see "Cannot read property of null":</h3>
            <p>The HTML elements (businessGrid, businessCount) don't exist. Check your HTML structure.</p>
        </div>
        
        <div class="error-fix">
            <h3>If it still shows "Loading..." forever:</h3>
            <p>The JavaScript isn't running at all. Check for syntax errors or missing script tags.</p>
        </div>
    </div>

    <div class="fix-card">
        <h2>üìã What I Need From You</h2>
        
        <div class="step">
            <h3>After trying the debug version, tell me:</h3>
            <ol>
                <li><strong>Console messages:</strong> What do you see when you open F12 ‚Üí Console?</li>
                <li><strong>Error messages:</strong> Any red errors?</li>
                <li><strong>Loading behavior:</strong> Does it get past "Connecting to Google Sheets"?</li>
                <li><strong>Business count:</strong> How many businesses does it find?</li>
            </ol>
            
            <p>With this info, I can give you the exact fix needed!</p>
        </div>
    </div>
</body>
</html>
